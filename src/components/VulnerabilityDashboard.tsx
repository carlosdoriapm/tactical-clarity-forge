import { useTacticalAnalysis } from '@/hooks/useTacticalAnalysis';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { AlertTriangle, BarChart, BrainCircuit, ShieldCheck, Target, TrendingUp, Siren } from 'lucide-react';
import { Link } from 'react-router-dom';

export const VulnerabilityDashboard = () => {
  const { data: analysis, isLoading, error } = useTacticalAnalysis();

  const renderContent = () => {
    if (isLoading) {
      return (
        <div className="flex items-center space-x-2 text-warfare-gray">
          <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-warfare-accent"></div>
          <span>Analyzing combat intelligence...</span>
        </div>
      );
    }

    if (error) {
      return (
        <div className="text-warfare-red flex items-center">
          <AlertTriangle className="w-5 h-5 mr-2" />
          <p>Error loading analysis: {error.message}</p>
        </div>
      );
    }
    
    if (analysis?.noProfile) {
        return (
          <div className="text-warfare-gray flex items-center">
            <AlertTriangle className="w-5 h-5 mr-2" />
            <p>Complete your <Link to="/profile" className="text-warfare-accent underline hover:text-warfare-accent/80">combatant profile</Link> to receive analyses.</p>
          </div>
        );
    }

    if (analysis?.insufficientData) {
      return (
        <div className="text-warfare-gray flex items-center">
          <BarChart className="w-5 h-5 mr-2" />
          <p>Insufficient data for analysis. Record more <Link to="/profile" className="text-warfare-accent underline hover:text-warfare-accent/80">War Logs</Link> to get detailed insights.</p>
        </div>
      );
    }

    if (analysis) {
      return (
        <div className="space-y-6">
          {analysis.predictiveAlert && (
            <div className="flex items-start p-4 rounded-lg bg-warfare-red/10 border border-warfare-red/30">
              <Siren className="w-6 h-6 mr-4 mt-1 text-warfare-red flex-shrink-0" />
              <div>
                <h3 className="font-semibold text-warfare-red">Predictive Alert</h3>
                <p className="text-white/90">{analysis.predictiveAlert}</p>
              </div>
            </div>
          )}
          {analysis.positivePattern && (
            <div className="flex items-start">
              <TrendingUp className="w-6 h-6 mr-4 mt-1 text-green-400 flex-shrink-0" />
              <div>
                <h3 className="font-semibold text-warfare-accent">Recurring Success Pattern</h3>
                <p className="text-white/90">{analysis.positivePattern}</p>
              </div>
            </div>
          )}
          {analysis.recurringFailurePattern && (
            <div className="flex items-start">
              <Target className="w-6 h-6 mr-4 mt-1 text-warfare-red flex-shrink-0" />
              <div>
                <h3 className="font-semibold text-warfare-accent">Recurring Failure Pattern</h3>
                <p className="text-white/90">{analysis.recurringFailurePattern}</p>
              </div>
            </div>
          )}
          {analysis.coreVulnerability && (
            <div className="flex items-start">
              <AlertTriangle className="w-6 h-6 mr-4 mt-1 text-yellow-400 flex-shrink-0" />
              <div>
                <h3 className="font-semibold text-warfare-accent">Core Vulnerability Exposed</h3>
                <p className="text-white/90">{analysis.coreVulnerability}</p>
              </div>
            </div>
          )}
          {analysis.strategicDirective && (
            <div className="flex items-start">
              <ShieldCheck className="w-6 h-6 mr-4 mt-1 text-warfare-blue flex-shrink-0" />
              <div>
                <h3 className="font-semibold text-warfare-accent">Immediate Strategic Directive</h3>
                <p className="text-white/90">{analysis.strategicDirective}</p>
              </div>
            </div>
          )}
        </div>
      );
    }
    
    return <p className="text-warfare-gray">No tactical analysis available at the moment.</p>;
  };

  return (
    <Card className="bg-warfare-card border-warfare-gray/20 text-white">
      <CardHeader>
        <CardTitle className="flex items-center text-xl">
          <BrainCircuit className="w-6 h-6 mr-3 text-warfare-blue" />
          Tactical Intelligence Report
        </CardTitle>
        <CardDescription>AI analysis of your combat patterns based on your War Logs.</CardDescription>
      </CardHeader>
      <CardContent>
        {renderContent()}
      </CardContent>
    </Card>
  );
};
